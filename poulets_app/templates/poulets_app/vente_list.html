{% extends "poulets_app/base.html" %}
{% load static humanize %}

{% block title %}Ventes & Factures – DjodeSync{% endblock %}

{% block content %}
<div class="mb-10">
  <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
    <div>
      <h1 class="text-5xl font-black text-gray-900">Ventes & Facturation</h1>
      <p class="text-2xl text-gray-600 mt-3">
        Chiffre d’affaires ce mois-ci : 
        <span class="text-emerald-600 font-black">{{ total_ventes_mois|intcomma }} FCFA</span>
      </p>
    </div>
    <a href="{% url 'admin:poulets_app_vente_add' %}"
       class="mt-6 lg:mt-0 px-10 py-5 bg-gradient-to-r from-red-600 to-red-700 text-white font-black text-xl rounded-2xl shadow-2xl hover:from-red-700 hover:to-red-800 transform hover:-translate-y-1 transition">
      <i class="fas fa-plus mr-3"></i> Nouvelle vente
    </a>
  </div>
</div>

<!-- Filtres -->
<div class="bg-white rounded-2xl shadow-xl p-8 mb-10">
  <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <input type="text" name="q" value="{{ request.GET.q|default:'' }}" placeholder="Rechercher client, facture..."
           class="px-6 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-red-100">
    <select name="statut" class="px-6 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-red-100">
      <option value="">Tous les statuts</option>
      <option value="payee" {% if request.GET.statut == 'payee' %}selected{% endif %}>Payée</option>
      <option value="confirmee" {% if request.GET.statut == 'confirmee' %}selected{% endif %}>Confirmée</option>
      <option value="brouillon" {% if request.GET.statut == 'brouillon' %}selected{% endif %}>Brouillon</option>
    </select>
    <button type="submit" class="px-10 py-4 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700 transition">
      Filtrer
    </button>
  </form>
</div>

<!-- Tableau des ventes -->
<div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
  <table class="w-full">
    <thead class="bg-gradient-to-r from-red-600 to-red-700 text-white">
      <tr>
        <th class="px-8 py-6 text-left font-bold">Facture</th>
        <th class="px-8 py-6 text-left font-bold">Date</th>
        <th class="px-8 py-6 text-left font-bold">Client</th>
        <th class="px-8 py-6 text-center font-bold">Quantité</th>
        <th class="px-8 py-6 text-right font-bold">Montant</th>
        <th class="px-8 py-6 text-center font-bold">Statut</th>
        <th class="px-8 py-6 text-center font-bold">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
      {% for vente in ventes %}
      <tr class="hover:bg-gray-50 transition">
        <td class="px-8 py-6 font-bold text-red-600 text-lg">{{ vente.numero }}</td>
        <td class="px-8 py-6">{{ vente.date_vente|date:"d/m/Y" }}</td>
        <td class="px-8 py-6">
          <div class="font-semibold">{{ vente.client_nom }}</div>
          <div class="text-sm text-gray-500">{{ vente.client_telephone }}</div>
        </td>
        <td class="px-8 py-6 text-center text-2xl font-bold">{{ vente.quantite }}</td>
        <td class="px-8 py-6 text-right text-2xl font-black text-emerald-700">
          {{ vente.montant_total|intcomma }} FCFA
        </td>
        <td class="px-8 py-6 text-center">
          {% if vente.statut == 'payee' %}
            <span class="px-6 py-3 bg-emerald-600 text-white font-bold rounded-full">PAYÉE</span>
          {% elif vente.statut == 'confirmee' %}
            <span class="px-6 py-3 bg-blue-600 text-white font-bold rounded-full">CONFIRMÉE</span>
          {% elif vente.statut == 'brouillon' %}
            <span class="px-6 py-3 bg-gray-500 text-white font-bold rounded-full">BROUILLON</span>
          {% else %}
            <span class="px-6 py-3 bg-red-600 text-white font-bold rounded-full">ANNULÉE</span>
          {% endif %}
        </td>
        <td class="px-8 py-6 text-center space-x-4">
          <a href="{% url 'admin:poulets_app_vente_change' vente.id %}" class="text-blue-600 hover:text-blue-900 font-bold">
            Modifier
          </a>
          <a href="#" class="text-emerald-600 hover:text-emerald-800 font-bold">
            PDF
          </a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center py-24 text-gray-500">
          <i class="fas fa-shopping-cart text-8xl mb-6 text-gray-300"></i>
          <p class="text-3xl">Aucune vente enregistrée</p>
          <a href="{% url 'admin:poulets_app_vente_add' %}" class="text-red-600 text-xl hover:underline">Faire la première vente ?</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}